# UrlShortenerApi - .NET Core

## Description

This project is simple yet powerful url shortener service api implemented with .NET Core.

It uses Entity Framework Core to communicate with a Postgres database, which contains a record for each of shortened urls. 

It has been released, as is, using an MIT licence. For more information on the MIT licence, please see either the `LICENSE` file in the root of the repository or see the tl;dr Legal page for [MIT](https://tldrlegal.com/license/mit-license)


## STEP1 : Creating the Database

This will need to be perfored before running the application for the first time.
First clone this repository.
Note that you must have postgresql already installed.
Note that you must check `ConnectionString` and change it according your database authorization information.

1. Change to the root src directory (i.e. `urlshortener/src`)

    `cd urlshortener/src`

2. Issue the Entity Framework command to add a new migrations

    `dotnet ef migrations add urlshortener.DbMig1`

    This will add a new migration files.

3. Issue the EF command to update database by migration created before

    `dotnet ef database update`

## Building and Running

1. Change to the api root src directory (i.e. `urlshortener/src`)

    `cd src`

2. Issue the `dotnet` restore command (this resolves all NuGet packages)

    `dotnet restore`

3. Issue the `dotnet` build command

    `dotnet build`

4. Issue the `dotnet` run command

    `dotnet run`

    This will start the Kestrel webserver, load the `urlshortener` application and tell you, via the terminal, what the url to access `urlshortener` will be. Usually this will be `http://localhost:5000`, but it may be different based on your system configuration.

## Testing

This repository contains an xUnit.NET test library plus RestAssured wrapper library. To run the tests:

1. Change directory to the tests directory

    `cd urlshortener/tests`

2. Issue the `dotnet` restore command (this resolves all NuGet packages)

    `dotnet restore`

3. Issue the `test` command

    `dotnet test`

    All tests will be run against a new build of `urlshortener test service` and results will be returned in the open shell/command prompt window.

## Polling and Usage of the API

`urlshortener` has the following Controllers:

1. Urls

    The `Urls` controller has two methods:

    1. Get

        The `Get` action receives all available short-long-longUri triplets as JSON, they would set a GET request to:

            /urls
        
        This will return the following JSON data:

            ```json
            [
                {
                    "longUrl": "http://www.google.com",
                    "longAbsoluteUri": "http://www.google.com/",
                    "shortUrl": "HZlApcSm"
                },
                {
                    "longUrl": "http://foo.bar?q=Spaces should be encoded",
                    "longAbsoluteUri": "http://foo.bar/?q=Spaces%20should%20be%20encoded",
                    "shortUrl": "uWNgGURl"
                },
                {
                    "longUrl": "http://علی@asghar.ایران:8080/naghi?q=حسین#محمد",
                    "longAbsoluteUri": "http://%D8%B9%D9%84%DB%8C@asghar.xn--mgba3a4f16a:8080/naghi?q=%D8%AD%D8%B3%DB%8C%D9%86#%D9%85%D8%AD%D9%85%D8%AF",
                    "shortUrl": "GCcZmbNT"
                },
                {
                    "longUrl": "http://salam.ir",
                    "longAbsoluteUri": "http://salam.ir/",
                    "shortUrl": "KEOGTBLV"
                },
            ]
            ```
            

    2. Post

        The `Post` action takes a JSON as body data payload. `{"LongUrl" : "Your.long.url.to.get.shorter"}`. `urlshortener` will then assign a unique 8 charatcer code to that long url you provided and response to you like this :
        Imagine that our sample long url is this : `https://www.google.com/search?q=علی بابا&oqعلی بابا7&aqs=chrome..69i57j69i61l2.1124j0j7&sourceid=chrome&ie=UTF`

        the response body will be JSON like this :

        ```json
        {
            "longUrl": "https://www.google.com/search?q=علی بابا&oqعلی بابا7&aqs=chrome..69i57j69i61l2.1124j0j7&sourceid=chrome&ie=UTF-8",
            "longAbsoluteUri": "https://www.google.com/search?q=%D8%B9%D9%84%DB%8C%20%D8%A8%D8%A7%D8%A8%D8%A7&oq%D8%B9%D9%84%DB%8C%20%D8%A8%D8%A7%D8%A8%D8%A77&aqs=chrome..69i57j69i61l2.1124j0j7&sourceid=chrome&ie=UTF-8",
            "shortUrl": "SmZXTmpd"
        }
        ```


2. Redirect

   The `Redirect` controller has one method:

   1. Get

    The `Get` action takes a string as shorten value generated by the POST controller.
    When you call this method with a shorten string, the service will then redirect you with `302 Found` status to long url corresponding this short url. 

            /redirect/SmZXTmpd
    
    This will redirect you to long url service generated above which is:
            "https://www.google.com/search?q=%D8%B9%D9%84%DB%8C%20%D8%A8%D8%A7%D8%A8%D8%A7&oq%D8%B9%D9%84%DB%8C%20%D8%A8%D8%A7%D8%A8%D8%A77&aqs=chrome..69i57j69i61l2.1124j0j7&sourceid=chrome&ie=UTF-8"
            

# Final Words
Thank You :)